# Aria v4.3 开发方案：阶梯式长期记忆系统

## 1. 设计哲学

针对 **M4 芯片性能保护** 与 **长期运行稳定性**，采用“重要度驱动”的非线性记忆管理，拒绝全量存储，追求高信息密度。

## 2. 三层存储架构

| **层级** | **名称**       | **存储介质**  | **生命周期** | **核心逻辑**                       |
| -------- | -------------- | ------------- | ------------ | ---------------------------------- |
| **L1**   | **活跃意识层** | RAM           | 15-20 轮     | 20轮触发滚动压缩，前10轮蒸馏为摘要 |
| **L2**   | **事实资产库** | `facts.json`  | 长期(带权重) | 重要度分级(1-10)，JIT 语义检索注入 |
| **L3**   | **深层日志区** | `history.log` | 永久         | 仅追加(Append-only)，全量原始备份  |

------

## 3. L2 事实筛选与注入算法

### A. 静态必选 ($Score \ge 8$)

- **内容**：环境偏好、长期目标、人格定义。
- **处理**：固定存在于每次请求的 System Prompt 中。

### B. 语义关联 ($5 \le Score < 8$)

- **内容**：特定项目进度、技术细节、子任务状态。
- **逻辑**：根据用户输入关键词（Tags）匹配命中后，按需唤醒。

### C. 遗忘与降级机制

- **沉降**：低访问频次或已过期的事实（$Score < 5$），从 L2 物理删除并归档至 L3。
- **冲突处理**：新旧事实冲突时，自动覆盖并记录变更历史。

------

## 4. 远期规划：数字化遗产 (3-Year Plan)

L3 层采用全量原始对答记录，不参与实时运算，旨在为未来（如 Mac mini 运行环境）提供微调数据源，实现 Aria “意识”的跨代无损迁移。